<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cash Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h2 class="mb-4 text-center">Cash Manager</h2>

    <form id="entryForm" class="row g-3">
      <div class="col-md-2">
        <input type="date" id="date" class="form-control" required>
      </div>
      <div class="col-md-2">
        <!-- Updated Head Field with Datalist -->
        <input type="text" id="head" class="form-control" list="headOptions" placeholder="Head" required>
        <datalist id="headOptions"></datalist>
      </div>
      <div class="col-md-2">
        <input type="number" step="0.01" id="cashIn" class="form-control" placeholder="Cash In">
      </div>
      <div class="col-md-2">
        <input type="number" step="0.01" id="cashOut" class="form-control" placeholder="Cash Out">
      </div>
      <div class="col-md-2">
        <select id="transactionType" class="form-select" required>
          <option value="" disabled selected>Select Type</option>
          <option value="Cash">Cash</option>
          <option value="Credit">Credit</option>
          <option value="Debit">Debit</option>
        </select>
      </div>
      <div class="col-md-2">
        <input type="text" id="notes" class="form-control" placeholder="Notes">
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">Add Entry</button>
      </div>
    </form>

    <div class="mt-4">
      <h5>Current Balance: ₹<span id="balance">0.00</span></h5>
    </div>

    <table class="table table-bordered table-striped mt-3">
      <thead class="table-dark">
        <tr>
          <th>Date</th>
          <th>Head</th>
          <th>Cash In</th>
          <th>Cash Out</th>
          <th>Balance</th>
          <th>Transaction Type</th>
          <th>Notes</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <!-- Entries will be loaded here -->
      </tbody>
    </table>
  </div>

  <script>
    let currentBalance = 0;
    const headSet = new Set();

    function updateHeadOptions() {
      const datalist = document.getElementById("headOptions");
      datalist.innerHTML = ''; // Clear existing options
      headSet.forEach(head => {
        const option = document.createElement('option');
        option.value = head;
        datalist.appendChild(option);
      });
    }

    document.getElementById("entryForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const date = document.getElementById("date").value;
      const head = document.getElementById("head").value;
      const cashIn = parseFloat(document.getElementById("cashIn").value) || 0;
      const cashOut = parseFloat(document.getElementById("cashOut").value) || 0;
      const transactionType = document.getElementById("transactionType").value;
      const notes = document.getElementById("notes").value;

      currentBalance += cashIn - cashOut;
      document.getElementById("balance").innerText = currentBalance.toFixed(2);

      const tableBody = document.getElementById("tableBody");
      const row = document.createElement("tr");

      row.innerHTML = `
        <td>${date}</td>
        <td>${head}</td>
        <td>₹${cashIn.toFixed(2)}</td>
        <td>₹${cashOut.toFixed(2)}</td>
        <td>₹${currentBalance.toFixed(2)}</td>
        <td>${transactionType}</td>
        <td>${notes}</td>
        <td><button class="btn btn-danger btn-sm deleteBtn">Delete</button></td>
      `;

      row.dataset.cashIn = cashIn;
      row.dataset.cashOut = cashOut;

      tableBody.appendChild(row);
      document.getElementById("entryForm").reset();

      // Add new head to the list if it's not already there
      if (head && !headSet.has(head)) {
        headSet.add(head);
        updateHeadOptions();
      }
    });

    document.getElementById("tableBody").addEventListener("click", function (e) {
      if (e.target.classList.contains("deleteBtn")) {
        const row = e.target.closest("tr");
        const cashIn = parseFloat(row.dataset.cashIn);
        const cashOut = parseFloat(row.dataset.cashOut);

        currentBalance -= (cashIn - cashOut);
        document.getElementById("balance").innerText = currentBalance.toFixed(2);

        row.remove();
      }
    });
  </script>
</body>
</html>